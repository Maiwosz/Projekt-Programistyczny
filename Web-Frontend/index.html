<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Style aplikacji -->
    <link rel="stylesheet" href="./styles/styles.css">
	<link rel="stylesheet" href="./styles/sync.css">
    <link rel="stylesheet" href="./styles/mainpage.css">
	<link rel="stylesheet" href="./styles/trash.css">
    <!-- Skrypt autoryzacyjny musi być dodany jako pierwszy -->
    <script src="./scripts/auth.js"></script>
    <!-- Moduły aplikacji -->
    <script type="module" src="./scripts/main.js"></script>
</head>
<body>
    <!-- Sekcja widoczna TYLKO po zalogowaniu - cała zawartość mainpage.html -->
    <div class="logged-in" style="display: none;">
        <div class="container">
            <!-- Główny nagłówek z przyciskami akcji -->
            <div class="header">
                <h1 id="username2"></h1>
                <div class="upload-section">
                    <button onclick="open_profile_edit()">Edytuj profil</button>
                    <button onclick="logout()">Wyloguj</button>
                </div>
            </div>
            <!-- Główna sekcja strony -->
            <div id="layout">
                <!-- Sidebar z drzewem folderów -->
                <div id="sidebar">
                    <div class="sidebar-header">
                        <span style="margin-right:15px;"> Foldery</span>
                    </div>
                    <div id="folderTree">
                        <!-- Tutaj będzie dynamicznie wczytywane drzewo folderów -->
                    </div>
                </div>
                <div class="main-content">
                    <div class="header">
                        <h2>Twoje pliki</h2>
                        <div class="upload-section">
                            <button onclick="triggerFileInput(false)">Dodaj plik</button>
                            <button onclick="triggerFileInput(true)">Dodaj wiele</button>
                            <button onclick="showCreateFolderModal()">Nowy folder</button>
							<button onclick="showTrashModal()">Kosz</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 80px 1fr; gap: 15px;">
                        <div class="breadcrumbs"> Ścieżka: </div>
                        <div class="breadcrumbs" id="breadcrumbs">
                            
                        </div>
                    </div>

                    <!-- Główna sekcja z zawartością -->
                    <div class="section">
                        <div class="items-list" id="dirsList">
                            <!-- Tutaj będą dynamicznie wczytywane foldery -->
                        </div>
                        <div class="items-list" id="itemsList">
                            <!-- Tutaj będą dynamicznie wczytywane pliki -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal do tworzenia folderu -->
        <div id="folderModal" class="modal">
            <h3>Nowy folder</h3>
            <input type="text" id="folderName" placeholder="Nazwa folderu">
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button onclick="createFolder()">Utwórz</button>
                <button onclick="closeFolderModal()" style="background: #6c757d;">Anuluj</button>
            </div>
        </div>
        
        <!-- Modal do podglądu pliku i metadanych -->
        <div id="fileModal" class="modal" style="max-width: 800px;">
            <div id="modalContent">
                <div class="modalContentDivide">
                    <!-- Lewa kolumna - podgląd -->
                    <div>
                        <span class="close-button-modal" onclick="closeFileModal()">&times;</span>
                        <div id="filePreviewLarge"></div>
                        <div id="fileInfo" style="margin-top: 15px;">
                            <p><strong>Nazwa:</strong> <span id="fileName"></span></p>
                            <p><strong>Typ:</strong> <span id="fileType"></span></p>
                            <p><strong>Rozmiar:</strong> <span id="fileSize"></span></p>
                            <p><strong>Data dodania:</strong> <span id="fileDate"></span></p>
                        </div>
                    </div>
                    
                    <!-- Prawa kolumna - metadane -->
                    <div>
                        <h3 style="margin-top: 0;">Metadane</h3>
                        <form id="metadataForm">
                            <div id="metadataFields"></div>
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button type="button" onclick="saveMetadata(event)">Zapisz zmiany</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal kosza -->
		<div id="trashModal" class="modal" style="max-width: 900px;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Kosz</h3>
					<button onclick="closeTrashModal()" class="close-button">&times;</button>
				</div>
				
				<div class="trash-actions" style="margin-bottom: 20px;">
					<button onclick="emptyTrash()" class="btn-danger">Opróżnij kosz</button>
				</div>
				
				<div id="trashItems" class="items-list">
					<!-- Tutaj będą wyświetlane usunięte pliki -->
				</div>
				
				<div style="margin-top: 20px; text-align: right;">
					<button onclick="closeTrashModal()" class="btn-secondary">Zamknij</button>
				</div>
			</div>
		</div>
		
		<!-- Modal synchronizacji -->
		<div id="syncModal" class="modal" style="max-width: 1000px;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Synchronizacja folderu: <span id="syncFolderName"></span></h3>
					<button onclick="closeSyncModal()" class="close-button">&times;</button>
				</div>
				
				<div id="syncContent">
					<div class="sync-loading" id="syncLoading" style="text-align: center; padding: 20px;">
						Ładowanie synchronizacji...
					</div>
					
					<div id="syncList" style="display: none;">
						<!-- Lista synchronizacji będzie tutaj dynamicznie wczytana -->
					</div>
					
					<div id="noSyncData" style="display: none; text-align: center; padding: 20px; color: #666;">
						Ten folder nie ma skonfigurowanych synchronizacji.
					</div>
				</div>
				
				<div class="modal-footer" style="margin-top: 20px; text-align: right;">
					<button onclick="closeSyncModal()" class="btn-secondary">Zamknij</button>
				</div>
			</div>
		</div>

		<!-- Modal szczegółów synchronizacji -->
		<div id="syncDetailsModal" class="modal" style="max-width: 800px;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Szczegóły synchronizacji</h3>
					<button onclick="closeSyncDetailsModal()" class="close-button">&times;</button>
				</div>
				
				<div id="syncDetailsContent">
					<!-- Treść będzie wczytana dynamicznie -->
				</div>
				
				<div class="modal-footer" style="margin-top: 20px; display: flex; justify-content: space-between;">
					<button onclick="deleteSyncConfig()" class="btn-danger">Usuń synchronizację</button>
					<div>
						<button onclick="saveSyncChanges()" class="btn-primary">Zapisz zmiany</button>
						<button onclick="closeSyncDetailsModal()" class="btn-secondary">Anuluj</button>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Modal tworzenia synchronizacji -->
		<div id="createSyncModal" class="modal" style="max-width: 1200px;">
			<div class="modal-content">
				<div class="modal-header">
					<h3>Utwórz synchronizację z Google Drive</h3>
					<button onclick="closeCreateSyncModal()" class="close-button">&times;</button>
				</div>
				
				<div class="sync-setup-container">
					<!-- Lewa kolumna - wybór folderu Google Drive -->
					<div class="drive-folder-selection">
						<h4>Wybierz folder na Google Drive</h4>
						<div class="sync-local-folder">
							<strong>Folder lokalny:</strong> <span id="syncLocalFolderName"></span>
						</div>
						
						<div id="driveBreadcrumbs" class="drive-breadcrumbs">
							Google Drive / Root
						</div>
						
						<div id="driveFoldersLoading" class="sync-loading">
							Ładowanie folderów z Google Drive...
						</div>
						
						<div id="driveFoldersList" class="drive-folders-list" style="display: none;">
							<!-- Lista folderów będzie tutaj -->
						</div>
						
						<div id="selectedDriveFolderInfo" class="selected-folder-info">
							<!-- Informacje o wybranym folderze -->
						</div>
					</div>
					
					<!-- Prawa kolumna - ustawienia synchronizacji -->
					<div class="sync-settings">
						<h4>Ustawienia synchronizacji</h4>
						
						<div class="sync-form-group">
							<label for="newSyncDirection">Kierunek synchronizacji:</label>
							<select id="newSyncDirection">
								<option value="bidirectional">Dwukierunkowa</option>
								<option value="to-client">Tylko do Google Drive</option>
								<option value="from-client">Tylko z Google Drive</option>
							</select>
						</div>
						
						<div class="sync-form-group">
							<label>
								<input type="checkbox" id="newSyncActive" checked> 
								Aktywuj synchronizację od razu
							</label>
						</div>
						
						<div class="sync-form-group">
							<label for="newSyncFolderName">Nazwa folderu (opcjonalne):</label>
							<input type="text" id="newSyncFolderName" placeholder="Domyślna nazwa folderu">
						</div>
						
						<div class="sync-filters">
							<h5>Filtry plików (opcjonalne)</h5>
							
							<div class="sync-form-group">
								<label for="newSyncMaxFileSize">Maksymalny rozmiar pliku (MB):</label>
								<input type="number" id="newSyncMaxFileSize" placeholder="Bez limitu">
							</div>
							
							<div class="sync-form-group">
								<label for="newSyncAllowedExt">Dozwolone rozszerzenia:</label>
								<input type="text" id="newSyncAllowedExt" placeholder="np. .jpg, .png, .pdf">
								<small>Oddzielone przecinkami, pozostaw puste dla wszystkich</small>
							</div>
							
							<div class="sync-form-group">
								<label for="newSyncExcludedExt">Wykluczone rozszerzenia:</label>
								<input type="text" id="newSyncExcludedExt" placeholder="np. .tmp, .log">
								<small>Oddzielone przecinkami</small>
							</div>
						</div>
					</div>
				</div>
				
				<div class="modal-footer" style="margin-top: 20px;">
					<div style="display: flex; justify-content: space-between; align-items: center;">
						<div>
							<button id="createSyncButton" onclick="createSyncConfiguration()" 
									class="btn-primary" style="display: none;">
								Utwórz synchronizację
							</button>
						</div>
						<div>
							<button onclick="closeCreateSyncModal()" class="btn-secondary">Anuluj</button>
						</div>
					</div>
				</div>
			</div>
		</div>

        <!-- Podgląd obrazka -->
        <div id="image-view-id" class="image-view">
            <span class="close-button" onclick="close_img_view()">&times;</span>
            <img id="image-zoom-id" class="image-zoom">
        </div>
    </div>
    
    <!-- Sekcja widoczna TYLKO dla niezalogowanych - zawartość aktualnego index.html -->
    <div class="logged-out" style="display: none;">
        <h1>Witaj gościu!</h1>
        <!-- Linki do logowania i rejestracji -->
        <a href="/login.html">Zaloguj się</a> | 
        <a href="/register.html">Zarejestruj</a>
    </div>
</body>
</html>